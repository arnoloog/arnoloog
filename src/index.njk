---
layout: layouts/base.njk
title: ARNOLOOG
---

<section class="home">
  <div class="home-grid">
    {% for roll in photos.rolls %}
      {# binnen elke roll: omkeren zodat 01 onderaan zit #}
      {% for item in roll.grid | reverse %}
        {% if item.isTrigger %}
          <a href="/rolls/{{ roll.name }}/" class="grid-item grid-item--trigger">
            <img src="{{ item.src }}" loading="lazy" alt="">
          </a>
        {% else %}
          <div class="grid-item">
            <img src="{{ item.src }}" loading="lazy" alt="">
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>

  <div class="fast-scroll-thumb" aria-label="fast scroll"></div>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const grid = document.querySelector(".home-grid");
  const items = [...grid.querySelectorAll(".grid-item, .grid-item--trigger")];
  
  const CHAOS_PER_ROLL = 15;
  const SCROLL_TRIGGER = 200; 
  let rollStartIndexes = [];

  // bepaal roll boundaries (roll1: 0-14, roll2: 15-29,...)
  for (let i = 0; i < items.length; i += CHAOS_PER_ROLL) {
    rollStartIndexes.push(i);
  }

  // random waarden toevoegen
  items.forEach((item) => {
    item.style.setProperty("--randX", Math.random());
    item.style.setProperty("--randY", Math.random());
    item.style.setProperty("--randR", Math.random());
    item.style.setProperty("--randS", Math.random());
  });

  // observe each roll-section
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;

      const start = parseInt(entry.target.dataset.start);
      const end = start + CHAOS_PER_ROLL;

      // CHAOS ON
      for (let i = start; i < end; i++) {
        const item = items[i];
        if (!item) continue;
        item.classList.add("chaos");
      }

      // SNAP after scroll
      const snapCheck = () => {
        if (window.scrollY > SCROLL_TRIGGER) {
          for (let i = start; i < end; i++) {
            const item = items[i];
            if (!item) continue;
            item.classList.remove("chaos");
            item.classList.add("snap");
          }
          window.removeEventListener("scroll", snapCheck);
        }
      };

      window.addEventListener("scroll", snapCheck, { passive: true });
    });
  }, { threshold: 0.2 });

  // maak "roll containers" virtueel
  rollStartIndexes.forEach((startIndex) => {
    const marker = document.createElement("div");
    marker.dataset.start = startIndex;
    marker.style.position = "absolute";
    marker.style.marginTop = `${items[startIndex].offsetTop}px`;
    marker.style.height = "1px";

    grid.appendChild(marker);
    observer.observe(marker);
  });

});
</script>
